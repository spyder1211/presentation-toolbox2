# 都留市HP Difyナレッジベース取込作業手順書

## 概要
都留市HP（https://www.city.tsuru.yamanashi.jp/）の情報をDifyのナレッジベースに取り込むための作業手順書

## 作業目的
市民からの自然言語での問い合わせに対応できるチャットボットを構築するため、都留市HPの情報をMD形式で構造化し、Difyのナレッジベースに取り込む

## 作業手順

### フェーズ1: 準備・調査
1. **都留市HPの構造調査**
   - メインメニュー構成の把握
   - サイトマップの確認
   - 主要カテゴリーの特定

2. **取得対象ページの選定**
   - 市民向けサービスページの優先順位付け
   - 更新頻度の高いページの識別
   - 重要度の評価基準設定

### フェーズ2: データ収集・変換

#### 2.1 カテゴリー別ページ収集

**主要カテゴリー:**
- [ ] 市民の方向けサービス
  - 手続き案内
  - 申請書ダウンロード
  - ゴミ出し検索ナビ
  - 施設マップ
  
- [ ] 安心・安全情報
  - 防災情報
  - 救急・消防・防犯
  - 防災無線情報
  
- [ ] 生活・くらし
  - 子育てサイト
  - 病院サイト
  - 定住サイト
  
- [ ] 市政情報
  - 組織案内
  - 例規集
  - イベントカレンダー

#### 2.2 データ変換手法

1. **WebスクレイピングによるHTML取得**
   ```
   - WebFetchツールを使用
   - 各ページのHTMLコンテンツを取得
   ```

2. **MD形式への変換**
   ```
   - HTMLタグの除去
   - 見出し構造の維持（h1→#、h2→##）
   - リスト形式の保持
   - 表形式データのMD変換
   - 内部リンクの相対パス化
   ```

3. **構造化データの作成**
   ```
   ファイル命名規則:
   [カテゴリー名]_[サブカテゴリー名]_[ページ名].md
   
   例: 市民サービス_手続き案内_住民票.md
   ```

### フェーズ3: データ整形・最適化

1. **メタデータの追加**
   - ページタイトル
   - カテゴリータグ
   - 最終更新日
   - 関連ページリンク

2. **内容の最適化**
   - 冗長な情報の削除
   - Q&A形式への変換（可能な場合）
   - キーワードの強調
   - 専門用語の説明追加

3. **クロスリファレンスの作成**
   - 関連ページ間のリンク構築
   - インデックスファイルの作成
   - カテゴリー別目次の生成

### フェーズ4: Dify取込準備

1. **ファイル構成の確認**
   ```
   都留市HP_Knowledge/
   ├── index.md（全体目次）
   ├── 市民サービス/
   │   ├── 手続き案内/
   │   ├── 申請書/
   │   └── ...
   ├── 安心安全/
   │   ├── 防災情報/
   │   └── ...
   └── ...
   ```

2. **データ検証**
   - MD形式の妥当性チェック
   - リンクの有効性確認
   - 文字コードの統一（UTF-8）

3. **分割戦略**
   - 大きなファイルの分割（5000字を目安）
   - コンテキストの維持
   - ナビゲーション情報の付与

### フェーズ5: Difyへの取込

1. **ナレッジベース設定**
   - 新規ナレッジベースの作成
   - インデックス設定
   - チャンク分割設定

2. **ファイルアップロード**
   - バッチアップロードの実施
   - エラーチェック
   - インデックス作成の確認

3. **テスト・検証**
   - サンプル質問での動作確認
   - 回答精度の評価
   - 必要に応じた調整

## 注意事項

- **著作権・利用規約の確認**
  - 都留市HPの利用規約を遵守
  - 公開情報のみを対象とする

- **更新管理**
  - 定期的な更新スケジュールの設定
  - 差分更新の仕組み構築

- **個人情報の取り扱い**
  - 個人情報を含むページの除外
  - プライバシーポリシーの遵守

## 作業見積もり

| フェーズ | 作業時間（目安） |
|---------|----------------|
| フェーズ1 | 2-3時間 |
| フェーズ2 | 8-12時間 |
| フェーズ3 | 4-6時間 |
| フェーズ4 | 2-3時間 |
| フェーズ5 | 2-3時間 |
| **合計** | **18-27時間** |

## 成果物

1. 都留市HP構造化MDファイル群
2. カテゴリー別インデックス
3. Dify取込用設定ファイル
4. 動作確認レポート

## 次のステップ

1. この手順書の承認を得る
2. 必要なツール・環境の準備
3. パイロット版として一部カテゴリーでの試行
4. 結果を踏まえた手順の改善
5. 全体展開の実施